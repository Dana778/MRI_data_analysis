# Аннотация

С развитием информационных технологий анализ медицинских изображений все
активнее применяется в диагностике заболеваний. МРТ --- это неинвазивный
метод исследования мягких тканей, основанный на воздействии магнитного
поля и радиочастотных импульсов. Исследования показывают, что МРТ может
быть полезен для ранней диагностики заболеваний, однако точность
автоматизированных методов интерпретации остаётся открытым вопросом.

Целью настоящей работы являлась проверка гипотезы о том, что с помощью
дискретной кривизны графа, построенного на основе корреляционной матрицы
активностей различных областей мозга, полученной с использованием
функциональной МРТ (фМРТ), возможно выявлять лёгкие когнитивные
нарушения с точностью выше 70%.

Проведённое исследование показало, что на текущем этапе дискретная
кривизна уступает по точности другим использованным методикам, которые
продемонстрировали более высокую валидность.

# Ключевые слова

Дискретная кривизна, кривизна Формана--Риччи, кривизна Олливье--Риччи,
графы мозга, функциональная МРТ, матрица корреляций, топология сетей,
анализ данных, метрики расстояния, кластеризация

# Введение

Современные методы анализа медицинских изображений, в частности
функциональной магнитно-резонансной томографии (фМРТ), активно
используются в задачах ранней диагностики когнитивных нарушений. Особое
внимание уделяется исследованию функциональных связей между отделами
мозга, которые можно представить в виде графов, где вершины
соответствуют мозговым регионам, а рёбра --- степени корреляции между
ними. Такой подход позволяет применять методы теории графов и сетевого
анализа для выявления патологий.

В рамках настоящей работы рассматривалась гипотеза о том, что дискретная
кривизна графов, построенных на основе корреляционных матриц активности
мозга, может служить информативным признаком для автоматического
распознавания лёгких когнитивных нарушений (MCI). Изучались два типа
кривизн: Формана--Риччи и Олливье--Риччи. В качестве данных
использовался набор фМРТ-изображений из открытого датасета OASIS-3, из
которого были отобраны 377 респондентов в возрасте от 42 до 95 лет ---
293 здоровых и 84 с различными когнитивными отклонениями.

Для каждого респондента был построен функциональный граф, рассчитаны
значения кривизн и выполнено сравнение между группами, а также попытки
кластеризации на основе полученных признаков. Несмотря на наличие
отдельных статистически значимых различий до поправки на множественные
проверки, общая точность классификации оказалась недостаточной
(наилучшие метрики качества кластеризации после корректировки ARI ≈
0.03, NMI ≈ 0.01), что не позволяет считать текущий метод
конкурентоспособным по сравнению с существующими подходами.

Тем не менее, проведённый анализ позволяет оценить применимость
дискретной кривизны для анализа мозговых сетей и намечает направления
для дальнейшего исследования: улучшение построения графов,
альтернативная векторизация признаков и объединение с другими методами
анализа фМРТ.

# Обзор литературы

Рассмотрение темы началось со статьи (M. O. Zubrikhinaa 2023),
посвященной диагностике легких когнитивных нарушений (MCI) на основе
МРТ-изображений. В работе рассматриваются морфометрические
характеристики мозга --- количественные параметры, такие как объем,
площадь и толщина коры. Авторы использовали Т1-взвешенные [^1] МРТ-сканы
и выявили ключевые морфометрические показатели. Наилучший результат был
получен с использованием метода опорных векторов (SVM)[^2], который
обеспечил точность 73%. Полученные данные подтверждают структурные
изменения мозга при MCI и демонстрируют потенциал машинного обучения в
ранней диагностике когнитивных нарушений. Настоящая работа направлена на
изучение возможности повышения точности классификации с использованием
альтернативных методов.

Статья  (Samal A. 2022) рассматривает применение кривизны Риччи для
выявления различий в функциональных связях мозга у людей с
расстройствами аутистического спектра (РАС). Мозг рассматривается как
сеть, состоящая из разных участков (вершин), которые связаны между собой
корреляцией (ребра) -- это есть функциональная сеть. Авторы обнаружили
статистически значимые различия (p \< 0.001 после поправки на
множественные сравнения) в средних значениях кривизны между группами РАС
и типично развивающимися контролями, а также выделили специфические
регионы мозга, где эти различия наиболее выражены. Подход основан на
геометрическом представлении сложных сетей, позволяющем моделировать
связи в различных областях. За основу взята идея представления сетей как
геометрических объектов (в данном случае графов), что дополняет
традиционные статистические и комбинаторные методы. Для изучения этих
подходов были рассмотрены работы  (Areejit Samal 2018), (Chien-Chun Ni
and Gao 2019) и видеолекции, подробные выкладки будут представлены ниже.

Для ознакомления с исходными данными, использованными в настоящем
исследовании, была изучена документация к датасету OASIS-3,
представленная в работе (OASIS-3 Consortium 2022). Датасет включает
структурные и функциональные МРТ-сканы 1379 респондентов в возрасте от
42 до 95 лет, собранные в рамках продольного наблюдения за когнитивным
здоровьем. Данные были получены в Вашингтонском университете (St. Louis,
Missouri, USA) и включают обследования как здоровых людей, так и
пациентов с различными стадиями когнитивных нарушений. Все персональные
данные респондентов были удалены в соответствии с протоколами
анонимизации, а уникальные идентификаторы заменены случайными кодами,
исключающими возможность восстановления личности участников. Датасет
содержит несколько типов МРТ-изображений, включая:

- Т1-взвешенные (T1w) и Т2-взвешенные (T2w) изображения, используемые
  для анализа морфометрических характеристик мозга;

- Диффузионно-тензорную визуализацию (DTI) для оценки структурных связей
  между областями мозга;

- Функциональную МРТ (fMRI), включая Task-based и Resting-state BOLD
  (Blood Oxygen Level Dependent) сканы, которые применяются для
  исследования функциональных сетей головного мозга.

В рамках данной работы использовались функциональные МРТ-сканы Task-rest
BOLD, поскольку они позволяют анализировать функциональные связи между
областями мозга в состоянии покоя, что имеет ключевое значение для
изучения различий между когнитивно здоровыми людьми и пациентами с
легкими когнитивными нарушениями.

# Ход работы и методы

## Теоретическая подготовка

На начальном этапе исследования был осуществлен анализ научной
литературы, направленный на изучение теоретических основ концепции
дискретной кривизны. В рамках данного анализа были рассмотрены различные
типы кривизны и их применения в медицине. Был проведен анализ
существующих проектов, в которых кривизна использовалась для изучения
структур данных и их топологических свойств. Детальные результаты
проведенного анализа представлены в разделах "Обзор литературы" и
"Теоретические выкладки" настоящего исследования.

## Подготовка данных

После изучения теоретической базы была проведена практическая реализация
исследования. Данные были получены из базы OASIS-3 и включали BOLD-fMRI
(Blood Oxygen Level Dependent) измерения в режимах extittask (выполнение
задачи) и extitrest (состояние покоя). Данные позволяли анализировать
корреляционные связи между отделами мозга в различных состояниях.
Исходные временные ряды представляли собой показатели активности
мозговых регионов, размеченных согласно атласу AAL-3. Первичная
предобработка данных была выполнена в Департаменте больших данных и
информационного поиска НИУ ВШЭ.

Выборка включала респондентов в возрасте от 42 до 95 лет, разделённых на
группы: здоровые, лица с лёгкими когнитивными нарушениями (MCI),
пациенты с болезнью Альцгеймера и с деменцией. Для последующего анализа
было необходимо выполнить дополнительную фильтрацию данных, исключив
участников без точных диагнозов, а также объекты с выбросами. В
результате предобработки осталось 377 объектов, из них 293 здоровых
респондента и 84 с когнитивными отклонениями

![Диаграмма распределения диагнозов среди респондентов с когнетивными
отклонениями](graphics/graphics/eilers.png)

На следующем этапе для каждого респондента была вычислена матрица
корреляций Пирсона, отражающая степень связности между различными
отделами мозга

Наименования регионов были извлечены из файла, прилагаемого к исходным
данным.

На основе полученных корреляционных матриц был построен полный,
взвешенный и неориентированный граф. В данном графе вершины
соответствовали областям мозга, а рёбра -- значениям корреляций между
ними. Алгоритм построения итогового функционального графа включал два
ключевых этапа:

1.  Выделение наиболее значимых рёбер посредством построения
    **максимального** остовного дерева (MST) с использованием алгоритма
    Крускала.

2.  Добавление оставшихся рёбер, отсортированных по убыванию веса,
    итеративно к MST до достижения порогового значения, заданного
    параметром функции (пример двумерного графа представлен на
    рис. [2](#fig:by_graph){reference-type="ref"
    reference="fig:by_graph"}) (Samal A. 2022).

Кроме того, была построена трехмерная визуализация связей.

![Функциональный граф одного из
респондентов.](graphics/graphics/graph_1.png)

## Вычисление кривизн

На третьем этапе исследования проводился расчёт кривизн графа.

Для обоих типов кривизн использовались следующие параметры:

- В качестве веса ребра $w_{e(v_1, v_2)}$ была взята величина
  $1 - |corr(v_1, v_2)|$, что отражает основную идею: чем сильнее
  корреляция, тем "выгоднее" данное ребро, так как оно обеспечивает
  более короткий путь. Абсолютное значение используется, поскольку как
  положительная, так и отрицательная сильная корреляция указывают на
  значимые зависимости между отделами мозга.

- В качестве веса вершины использовалась её степень.

- Кривизна вершины рассчитывалась как сумма кривизн всех инцидентных ей
  рёбер.

Сначала был реализован алгоритм вычисления кривизны Формана--Риччи.
Отдельно рассчитывались кривизны для рёбер и вершин, кривизна рёбер
определялась согласно
формуле ([\[eq:forman\]](#eq:forman){reference-type="ref"
reference="eq:forman"}).

Затем была реализована функция, вычисляющая кривизны Оливье--Риччи. Для
подсчета кривизн рёбер использовалась
формула ([\[eq:ollivier\]](#eq:ollivier){reference-type="ref"
reference="eq:ollivier"}). Для нахождения расстояния Васерштейна
применялась библиотека POT (Python Optimal Transport), а именно функции
`emd2` и `sinkhorn2` для точного и приближённого расчёта соответственно.
Для расчёта распределений $m_x$ и $m_y$ использовалась
формула ([\[eq:ollivier_m_x\]](#eq:ollivier_m_x){reference-type="ref"
reference="eq:ollivier_m_x"}) в соответствии с (Chien-Chun Ni and Gao
2019). Длины рёбер $d(x, y)$ также определялись как
$1 - |corr(v_1, v_2)|$, что подчёркивает значимость связей с высокой
корреляцией, так как такие рёбра должны быть "ближе" в графе.

Для удобства обработки данных был разработан класс для респондентов,
позволяющий компактно хранить и обновлять все ключевые характеристики. В
него вошли следующие параметры: диагнозы респондента, матрица
корреляций, функциональный граф, метод построения графа (с заданной
плотностью), вычисления кривизн Оливье и Формана--Риччи и другие
необходимые данные.

## Анализ зависимости средних кничений кривизн от плотности графа

Ключевым этапом работы стало применение метода, описанного в
статье (Samal A. 2022), для оценки его применимости к данным,
используемым в настоящей работе, а также для анализа потенциала
улучшения существующих методов диагностики болезни Альцгеймера,
результаты которых представлены в статье (M. O. Zubrikhinaa 2023). Для
каждого респондента была составлена таблица, показывающая зависимость
среднего значения кривизны от плотности графа. Процесс построения
таблицы включал следующие этапы:

1.  Для каждой плотности рёбер (от 2% до 60%, с шагом 1) строился
    отдельный граф.

2.  Для каждого графа рассчитывались кривизны по формулам Оливье--Риччи
    и Формана--Риччи.

3.  Для каждого значения плотности вычислялось среднее значение кривизны
    по рёбрам (сумма значений всех рёбер делится на их количество).

4.  Для каждой вершины рассчитывалось значение AUC (площадь под графиком
    зависимости значения кривизны вершины от плотности графа).

В результате для каждого респондента были получены две таблицы,
содержащие:

1.  Среднее значение кривизны Формана--Риччи рёбер для каждой плотности.

2.  Среднее значение кривизны Оливье--Риччи рёбер для каждой плотности.

3.  Среднее значение кривизны Формана--Риччи для каждой вершины при
    различной плотности.

4.  Среднее значение кривизны Оливье--Риччи для каждой вершины при
    различной плотности.

В связи с большим объёмом данных, на данном этапе работы потребовалось
исследование методов многопоточности на языке Python. Для решения задачи
был использован модуль multiprocessing, а именно его функции Pool и
get_context.

Далее был проведён статистический анализ результатов. Для каждой
плотности графа и каждой вершины по всем респондентам (значения кривизн
для всех участников были объединены в два вектора) выполнены тесты
значимости. Первоначально для каждой выборки проводилась проверка на
соответствие нормальному распределению. В случаях, когда оба вектора
имели нормальное распределение, использовался t-тест (с учётом равенства
дисперсий), в противном случае применялся критерий Манна--Уитни U.

  ------------------ ----------------- --------------- -----------------
  **FRC**                              **ORC**         
  **NodeID**         **p_value_raw**   **NodeID**      **p_value_raw**
  Vermis_3           0.001364          Vermis_3        0.009886
  Lingual_L          0.001758          Cuneus_L        0.015487
  Cingulate_Post_L   0.007519          Postcentral_R   0.022409
  Thal_VL_L          0.009854          Lingual_L       0.024422
  Cuneus_L           0.010149          Lingual_R       0.026128
  ------------------ ----------------- --------------- -----------------

  : Топ-5 наиболее значимых регионов мозга по значению $p$ для кривизн
  FRC и ORC.
:::

На первоначальном этапе анализа были выявлены области с $p-value<0.01$,
что указывало на статистически значимые различия между выборками
(Таблица [1]). Однако, поскольку проводилось
множественное тестирование, для контроля уровня ложных открытий была
применена коррекция False Discovery Rate (FDR) (Samal A. 2022). После
корректировки различия между выборками утратили статистическую
значимость.

![Графики зависимости кривизны на ребрах от плотности
графа.](graphics/graphics/output.png)

![Диаграмма различий средних значений кривизн
вершин.](graphics/graphics/vertex.png)

# Заключение

В ходе проведенного исследования была предпринята попытка классификации
состояний работы мозга на основе данных МРТ с использованием дискретной
кривизны. Изначальная гипотеза о возможности улучшения точности
диагностики когнитивных нарушений на ранних стадиях посредством анализа
корреляций областей мозга не получила подтверждения.

Полученные результаты могут быть обусловлены несколькими факторами.
Во-первых, ограниченный объем выборки мог не обеспечить достаточной
статистической мощности для выявления значимых различий между группами.
Во-вторых, вычислительные мощности, доступные для проведения
исследования, могли оказаться недостаточными для обработки и анализа
большего количества характеристик, что ограничило возможности
оптимизации модели.

В дальнейшем целесообразно увеличить объем выборки и рассмотреть
возможность использования более мощных вычислительных ресурсов для
проведения более глубокого анализа данных и подбора оптимальных
параметров модели. Также перспективным направлением является
исследование других методов машинного обучения и их комбинаций для
повышения точности классификации состояний работы мозга.