# Аннотация

С развитием информационных технологий анализ медицинских изображений все
активнее применяется в диагностике заболеваний. МРТ --- это неинвазивный
метод исследования мягких тканей, основанный на воздействии магнитного
поля и радиочастотных импульсов. Исследования показывают, что МРТ может
быть полезен для ранней диагностики заболеваний, однако точность
автоматизированных методов интерпретации остаётся открытым вопросом.

Целью настоящей работы являлась проверка гипотезы о том, что с помощью
дискретной кривизны графа, построенного на основе корреляционной матрицы
активностей различных областей мозга, полученной с использованием
функциональной МРТ (фМРТ), возможно выявлять лёгкие когнитивные
нарушения с точностью выше 70%.

Проведённое исследование показало, что на текущем этапе дискретная
кривизна уступает по точности другим использованным методикам, которые
продемонстрировали более высокую валидность.

# Ключевые слова

Дискретная кривизна, кривизна Формана--Риччи, кривизна Олливье--Риччи,
графы мозга, функциональная МРТ, матрица корреляций, топология сетей,
анализ данных, метрики расстояния, кластеризация

# Ход работы и методы

## Теоретическая подготовка

На начальном этапе исследования был осуществлен анализ научной
литературы, направленный на изучение теоретических основ концепции
дискретной кривизны. В рамках данного анализа были рассмотрены различные
типы кривизны и их применения в медицине. Был проведен анализ
существующих проектов, в которых кривизна использовалась для изучения
структур данных и их топологических свойств. Детальные результаты
проведенного анализа представлены в разделах "Обзор литературы" и
"Теоретические выкладки" настоящего исследования.

## Подготовка данных

После изучения теоретической базы была проведена практическая реализация
исследования. Данные были получены из базы OASIS-3 и включали BOLD-fMRI
(Blood Oxygen Level Dependent) измерения в режимах extittask (выполнение
задачи) и extitrest (состояние покоя). Данные позволяли анализировать
корреляционные связи между отделами мозга в различных состояниях.
Исходные временные ряды представляли собой показатели активности
мозговых регионов, размеченных согласно атласу AAL-3. Первичная
предобработка данных была выполнена в Департаменте больших данных и
информационного поиска НИУ ВШЭ.

Выборка включала респондентов в возрасте от 42 до 95 лет, разделённых на
группы: здоровые, лица с лёгкими когнитивными нарушениями (MCI),
пациенты с болезнью Альцгеймера и с деменцией. Для последующего анализа
было необходимо выполнить дополнительную фильтрацию данных, исключив
участников без точных диагнозов, а также объекты с выбросами. В
результате предобработки осталось 377 объектов, из них 293 здоровых
респондента и 84 с когнитивными отклонениями

![Диаграмма распределения диагнозов среди респондентов с когнетивными
отклонениями](graphics/graphics/eilers.png)

На следующем этапе для каждого респондента была вычислена матрица
корреляций Пирсона, отражающая степень связности между различными
отделами мозга

Наименования регионов были извлечены из файла, прилагаемого к исходным
данным.

На основе полученных корреляционных матриц был построен полный,
взвешенный и неориентированный граф. В данном графе вершины
соответствовали областям мозга, а рёбра -- значениям корреляций между
ними. Алгоритм построения итогового функционального графа включал два
ключевых этапа:

1.  Выделение наиболее значимых рёбер посредством построения
    **максимального** остовного дерева (MST) с использованием алгоритма
    Крускала.

2.  Добавление оставшихся рёбер, отсортированных по убыванию веса,
    итеративно к MST до достижения порогового значения, заданного
    параметром функции (пример двумерного графа представлен на
    рис. [2](#fig:by_graph)) (Samal A. 2022).

Кроме того, была построена трехмерная визуализация связей.

![Функциональный граф одного из
респондентов.](graphics/graphics/graph_1.png)

## Вычисление кривизн

На третьем этапе исследования проводился расчёт кривизн графа.

Для обоих типов кривизн использовались следующие параметры:

- В качестве веса ребра $w_{e(v_1, v_2)}$ была взята величина
  $1 - |corr(v_1, v_2)|$, что отражает основную идею: чем сильнее
  корреляция, тем "выгоднее" данное ребро, так как оно обеспечивает
  более короткий путь. Абсолютное значение используется, поскольку как
  положительная, так и отрицательная сильная корреляция указывают на
  значимые зависимости между отделами мозга.

- В качестве веса вершины использовалась её степень.

- Кривизна вершины рассчитывалась как сумма кривизн всех инцидентных ей
  рёбер.

Сначала был реализован алгоритм вычисления кривизны Формана--Риччи.
Отдельно рассчитывались кривизны для рёбер и вершин, кривизна рёбер
определялась согласно
формуле ([\[eq:forman\]](#eq:forman)).

Затем была реализована функция, вычисляющая кривизны Оливье--Риччи. Для
подсчета кривизн рёбер использовалась
формула ([\[eq:ollivier\]](#eq:ollivier)). Для нахождения расстояния Васерштейна
применялась библиотека POT (Python Optimal Transport), а именно функции
`emd2` и `sinkhorn2` для точного и приближённого расчёта соответственно.
Для расчёта распределений $m_x$ и $m_y$ использовалась
формула ([\[eq:ollivier_m_x\]](#eq:ollivier_m_x)) в соответствии с (Chien-Chun Ni and Gao
2019). Длины рёбер $d(x, y)$ также определялись как
$1 - |corr(v_1, v_2)|$, что подчёркивает значимость связей с высокой
корреляцией, так как такие рёбра должны быть "ближе" в графе.

Для удобства обработки данных был разработан класс для респондентов,
позволяющий компактно хранить и обновлять все ключевые характеристики. В
него вошли следующие параметры: диагнозы респондента, матрица
корреляций, функциональный граф, метод построения графа (с заданной
плотностью), вычисления кривизн Оливье и Формана--Риччи и другие
необходимые данные.

## Анализ зависимости средних кничений кривизн от плотности графа

Ключевым этапом работы стало применение метода, описанного в
статье (Samal A. 2022), для оценки его применимости к данным,
используемым в настоящей работе, а также для анализа потенциала
улучшения существующих методов диагностики болезни Альцгеймера,
результаты которых представлены в статье (M. O. Zubrikhinaa 2023). Для
каждого респондента была составлена таблица, показывающая зависимость
среднего значения кривизны от плотности графа. Процесс построения
таблицы включал следующие этапы:

1.  Для каждой плотности рёбер (от 2% до 60%, с шагом 1) строился
    отдельный граф.

2.  Для каждого графа рассчитывались кривизны по формулам Оливье--Риччи
    и Формана--Риччи.

3.  Для каждого значения плотности вычислялось среднее значение кривизны
    по рёбрам (сумма значений всех рёбер делится на их количество).

4.  Для каждой вершины рассчитывалось значение AUC (площадь под графиком
    зависимости значения кривизны вершины от плотности графа).

В результате для каждого респондента были получены две таблицы,
содержащие:

1.  Среднее значение кривизны Формана--Риччи рёбер для каждой плотности.

2.  Среднее значение кривизны Оливье--Риччи рёбер для каждой плотности.

3.  Среднее значение кривизны Формана--Риччи для каждой вершины при
    различной плотности.

4.  Среднее значение кривизны Оливье--Риччи для каждой вершины при
    различной плотности.

В связи с большим объёмом данных, на данном этапе работы потребовалось
исследование методов многопоточности на языке Python. Для решения задачи
был использован модуль multiprocessing, а именно его функции Pool и
get_context.

Далее был проведён статистический анализ результатов. Для каждой
плотности графа и каждой вершины по всем респондентам (значения кривизн
для всех участников были объединены в два вектора) выполнены тесты
значимости. Первоначально для каждой выборки проводилась проверка на
соответствие нормальному распределению. В случаях, когда оба вектора
имели нормальное распределение, использовался t-тест (с учётом равенства
дисперсий), в противном случае применялся критерий Манна--Уитни U.

  ------------------ ----------------- --------------- -----------------
  **FRC**                              **ORC**         
  **NodeID**         **p_value_raw**   **NodeID**      **p_value_raw**
  Vermis_3           0.001364          Vermis_3        0.009886
  Lingual_L          0.001758          Cuneus_L        0.015487
  Cingulate_Post_L   0.007519          Postcentral_R   0.022409
  Thal_VL_L          0.009854          Lingual_L       0.024422
  Cuneus_L           0.010149          Lingual_R       0.026128
  ------------------ ----------------- --------------- -----------------

  : Топ-5 наиболее значимых регионов мозга по значению $p$ для кривизн
  FRC и ORC.
:::

На первоначальном этапе анализа были выявлены области с $p-value<0.01$,
что указывало на статистически значимые различия между выборками
(Таблица [1]). Однако, поскольку проводилось
множественное тестирование, для контроля уровня ложных открытий была
применена коррекция False Discovery Rate (FDR) (Samal A. 2022). После
корректировки различия между выборками утратили статистическую
значимость.

![Графики зависимости кривизны на ребрах от плотности
графа.](graphics/graphics/output.png)

![Диаграмма различий средних значений кривизн
вершин.](graphics/graphics/vertex.png)

# Заключение

В ходе проведенного исследования была предпринята попытка классификации
состояний работы мозга на основе данных МРТ с использованием дискретной
кривизны. Изначальная гипотеза о возможности улучшения точности
диагностики когнитивных нарушений на ранних стадиях посредством анализа
корреляций областей мозга не получила подтверждения.

Полученные результаты могут быть обусловлены несколькими факторами.
Во-первых, ограниченный объем выборки мог не обеспечить достаточной
статистической мощности для выявления значимых различий между группами.
Во-вторых, вычислительные мощности, доступные для проведения
исследования, могли оказаться недостаточными для обработки и анализа
большего количества характеристик, что ограничило возможности
оптимизации модели.

В дальнейшем целесообразно увеличить объем выборки и рассмотреть
возможность использования более мощных вычислительных ресурсов для
проведения более глубокого анализа данных и подбора оптимальных
параметров модели. Также перспективным направлением является
исследование других методов машинного обучения и их комбинаций для
повышения точности классификации состояний работы мозга.